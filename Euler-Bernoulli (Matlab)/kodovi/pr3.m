l = 10;n = l*100;h = 1/n;x = linspace(0, l, n+1);EI = 0.1 * 1;f = -100;K_ = EI / h^3 * [ 12   6*h  -12   6*h                 6*h 4*h^2 -6*h 2*h^2                 -12  -6*h   12  -6*h                 6*h 2*h^2 -6*h 4*h^2];                F_ = f * [2*h/3            0          2*h/3            0];            K = zeros(2*n+2, 2*n+2);F = zeros(2*n+2, 1);F(2) = 2*h/15;F(2*n+2) = -2*h/15;for i = 1:n    K(2*i-1:2*i+2,2*i-1:2*i+2) = K(2*i-1:2*i+2,2*i-1:2*i+2) + K_;    F(2*i-1:2*i+2) = F(2*i-1:2*i+2) + F_;endK(1,:) = zeros(1, 2*n+2);K(:,1) = zeros(2*n+2, 1);K(1,1) = 1;K(2,:) = zeros(1, 2*n+2);K(:,2) = zeros(2*n+2, 1);K(2,2) = 1;K(2*n+1,:) = zeros(1, 2*n+2);K(:,2*n+1) = zeros(2*n+2, 1);K(2*n+1,2*n+1) = 1;K(2*n+2,:) = zeros(1, 2*n+2);K(:,2*n+2) = zeros(2*n+2, 1);K(2*n+2,2*n+2) = 1;F(1) = 0;F(2) = 0;F(2*n+1) = 0;F(2*n+2) = 0;U = K \ F;u = U(1:2:end)';z = linspace(-0.1, 0.1, 200)';figure(1);plot(x, u, 'b-', 0, z, 'k', l, z, 'k');xlim([-l/10, 11*l/10]);xlabel('x');ylabel('u(x)');legend('štap', 'zid');grid;saveas(gcf, 'u3.png');eps = 1e-5;c = zeros(1, 2*n+2);c(1:2:end) = -0.08 * (x - 5).^2 - 0.4;U_c = U;for k = 1:1000    U_k = (K + (1/eps) * M(n, c, U_c, @pen)) \ (K*U_c + gradj_eps(eps, n, c, U_c) - F);    U_c = U_c - U_k;endu_c = U_c(1:2:end)';figure(2);plot(x, c(1:2:end), 'r-', x, u_c, 'b-', 0, z, 'k', l, z, 'k');xlim([-l/10, 11*l/10]);xlabel('x');ylabel('u_c(x)');legend('prepreka', 'štap', 'zid');grid;saveas(gcf, 'u3_c.png');